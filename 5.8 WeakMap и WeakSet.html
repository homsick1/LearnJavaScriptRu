<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        'use strict'
        // // 1. WeakMap
        // // Ключи в WeakMap должны быть объектами, а не примитивными значениями
        // let weakMap = new WeakMap();
        // let obj = {};

        // weakMap.set(obj, "ok"); // Всё хорошо
        // weakMap.set("test", "Whoops"); // Ошибка

        // // Теперь, если мы используем объект в качестве ключа и если больше нет
        // // ссылок на этот объект, то он будет удален из памяти автоматически

        // let john = {name: "John"};
        // let weakMap = new WeakMap();

        // weakMap.set(john, "...");
        // john = null;

        // В WeakMap присутствуют только следующие методы:
        // - weakMap.get(key)
        // - weakMap.set(key, value)
        // - weakMap.delete(key)
        // - weakMap.has(key)

        // Дополнительные данные
        // В основном WeakMap используется в качестве дополнительного хранилища данных

        weakMap.set(john, "секретные документы");

        // Счетчик посещений 

        // visitsCount.js
        let visitsCountMap = new Map(); // если использовать weakMap будет происходить очистка автоматически

        function countUser(user) {
            let count = visitsCountMap.get(user) || 0;
            visitsCountMap.set(user, count + 1);
        }

        // main.js
        let john = { name: "John" };

        countUser(john);
        countUser(john);

        john = null;

        // Применение для кеширования

        // cache.js
        let cache = new Map(); // если использовать weakMap очистка кеша будет происходить  автоматически 

        function process(obj) {
            if (!cache.has(obj)) {
                let result = obj;
                cache.set(obj, result);
            }
            return cache.get(obj);
        }

        // main.js
        let obj = {};
        let result1 = process(obj);
        let result2 = process(obj);

        obj = null;
        alert(cache.size);




    </script>
</body>

</html>
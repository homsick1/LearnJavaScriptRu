<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        'use strict'
        // // 1. WeakMap
        // // Ключи в WeakMap должны быть объектами, а не примитивными значениями
        // let weakMap = new WeakMap();
        // let obj = {};

        // weakMap.set(obj, "ok"); // Всё хорошо
        // weakMap.set("test", "Whoops"); // Ошибка

        // // Теперь, если мы используем объект в качестве ключа и если больше нет
        // // ссылок на этот объект, то он будет удален из памяти автоматически

        // let john = {name: "John"};
        // let weakMap = new WeakMap();

        // weakMap.set(john, "...");
        // john = null;

        // // В WeakMap присутствуют только следующие методы:
        // // - weakMap.get(key)
        // // - weakMap.set(key, value)
        // // - weakMap.delete(key)
        // // - weakMap.has(key)

        // // Дополнительные данные
        // // В основном WeakMap используется в качестве дополнительного хранилища данных

        // weakMap.set(john, "секретные документы");

        // // Счетчик посещений 

        // // visitsCount.js
        // let visitsCountMap = new Map(); // если использовать weakMap будет происходить очистка автоматически

        // function countUser(user) {
        //     let count = visitsCountMap.get(user) || 0;
        //     visitsCountMap.set(user, count + 1);
        // }

        // // main.js
        // let john = { name: "John" };

        // countUser(john);
        // countUser(john);

        // john = null;

        // // Применение для кеширования

        // // cache.js
        // let cache = new Map(); // если использовать weakMap очистка кеша будет происходить  автоматически 

        // function process(obj) {
        //     if (!cache.has(obj)) {
        //         let result = obj;
        //         cache.set(obj, result);
        //     }
        //     return cache.get(obj);
        // }

        // // main.js
        // let obj = {};
        // let result1 = process(obj);
        // let result2 = process(obj);

        // obj = null;
        // alert(cache.size);

        // // 2. WeakSet
        // // Ключи в WeakMap должны быть объектами, а не примитивными значениями
        // // В WeakSet присутствуют только следующие методы:
        // // - WeakSet.get(key)
        // // - WeakSet.set(key, value)
        // // - WeakSet.delete(key)
        // // - WeakSet.has(key)

        // let visitedSet = new WeakSet();

        // let john = { name: "John" };
        // let pete = { name: "Pete" };
        // let mary = { name: "Mary" };

        // visitedSet.add(john);
        // visitedSet.add(pete);
        // visitedSet.add(john);

        // console.log(visitedSet.has(john));
        // console.log(visitedSet.has(mary));
        // john = null;
        // console.log(visitedSet.has(john));

        // // Задачи
        // // 1. Хранение отметок "не прочитано"
        // let message1 = { text: "Hello", from: "John" };
        // let message2 = { text: "How goes?", from: "John" };
        // let message3 = { text: "See you soon", from: "Alice" };

        // let readedMessages = new WeakSet();

        // readedMessages.add(message1);
        // readedMessages.add(message2);
        // readedMessages.add(message3);
        // console.log(readedMessages.has(message1));

        // message1 = null;           
        // console.log(readedMessages.has(message1));

        // 2. Хранение времени прочтения
        let messages = [
            { text: "Hello", from: "John" },
            { text: "How goes?", from: "John" },
            { text: "See you soon", from: "Alice" }
        ];
        
        let messagesDate = new WeakMap();

        messagesDate.set(messages[0], new Date(2017, 1, 1));

    </script>
</body>

</html>